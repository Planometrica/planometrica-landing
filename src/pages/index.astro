---
import Layout from '../layouts/Layout.astro'
import Hero from '../components/Hero.astro'
import ProblemSolution from '../components/ProblemSolution.astro'
import HowItWorks from '../components/HowItWorks.astro'
import Features from '../components/Features.astro'
import Products from '../components/Products.astro'
import Testimonials from '../components/Testimonials.astro'
import PricingPreview from '../components/PricingPreview.astro'
import ArchitecturalStyles from '../components/ArchitecturalStyles.astro'
import CTA from '../components/CTA.astro'

// Sanity imports
import {
  getHeroByName,
  getFeatures,
  getProducts,
  getTestimonials,
  getStats,
  getPricing
} from '../lib/sanity'

// Fetch data from Sanity (all in parallel)
const [hero, features, products, testimonials, stats, pricing] = await Promise.all([
  getHeroByName('home-hero'),
  getFeatures(),
  getProducts(),
  getTestimonials(),
  getStats(),
  getPricing()
])

const seoData = {
  title: 'Планометрика — AI проектирование дома онлайн',
  description: 'Создайте проект дома за 30 минут с AI-архитектором. Автоматическая проверка норм, подбор ипотеки, визуализация. Начните бесплатно!',
  keywords: 'проект дома, проектирование дома, AI архитектор, планировка дома, ИЖС проект, строительство дома',
  ogImage: '/images/og-home.jpg'
}
---

<Layout
  title={seoData.title}
  description={seoData.description}
  keywords={seoData.keywords}
  ogImage={seoData.ogImage}
  transparentHeader={true}
>
  <main>
    <!-- Hero Section -->
    <Hero hero={hero} />

    <!-- Problem/Solution: Why Планометрика -->
    <ProblemSolution />

    <!-- How It Works: 4 Steps -->
    <HowItWorks />

    <!-- Features Grid -->
    <Features features={features.length > 0 ? features : undefined} />

    <!-- Products Showcase -->
    <Products products={products.length > 0 ? products : undefined} />

    <!-- Architectural Styles -->
    <ArchitecturalStyles />

    <!-- Testimonials Carousel -->
    <Testimonials
      testimonials={testimonials.length > 0 ? testimonials : undefined}
      metrics={stats.length > 0 ? stats : undefined}
    />

    <!-- Pricing Preview -->
    <PricingPreview tiers={pricing.length > 0 ? pricing : undefined} />

    <!-- Final CTA -->
    <CTA />
  </main>
</Layout>
