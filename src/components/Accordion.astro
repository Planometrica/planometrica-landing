---
interface FAQItem {
  question: string
  answer: string
  category?: string
}

interface Props {
  items: FAQItem[]
  showCategories?: boolean
}

const { items, showCategories = false } = Astro.props

// Group items by category if needed
const groupedItems = showCategories
  ? items.reduce((acc, item) => {
      const category = item.category || 'Общие вопросы'
      if (!acc[category]) acc[category] = []
      acc[category].push(item)
      return acc
    }, {} as Record<string, FAQItem[]>)
  : { 'all': items }
---

<section class="py-20 lg:py-28 bg-white">
  <div class="container mx-auto px-4">
    <div class="max-w-3xl mx-auto">
      {Object.entries(groupedItems).map(([category, categoryItems]) => (
        <div class="mb-12 last:mb-0">
          {/* Category Title */}
          {showCategories && category !== 'all' && (
            <h3 class="text-xl font-bold text-gray-900 mb-6">{category}</h3>
          )}

          {/* Accordion Items */}
          <div class="space-y-4">
            {categoryItems.map((item, index) => (
              <div class="accordion-item border border-gray-200 rounded-xl overflow-hidden hover:border-[#1A7BB3]/30 transition-colors">
                <button
                  class="accordion-trigger w-full flex items-center justify-between p-5 text-left bg-white hover:bg-gray-50 transition-colors"
                  data-index={index}
                >
                  <span class="font-semibold text-gray-900 pr-4">{item.question}</span>
                  <svg class="accordion-icon w-5 h-5 text-[#0A4C76] flex-shrink-0 transform transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                <div class="accordion-content hidden">
                  <div class="px-5 pb-5 text-gray-600 leading-relaxed">
                    <Fragment set:html={item.answer} />
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const accordionItems = document.querySelectorAll('.accordion-item');

    accordionItems.forEach((item) => {
      const trigger = item.querySelector('.accordion-trigger');
      const content = item.querySelector('.accordion-content');
      const icon = item.querySelector('.accordion-icon');

      trigger?.addEventListener('click', () => {
        const isOpen = !content?.classList.contains('hidden');

        // Close all other items
        accordionItems.forEach((otherItem) => {
          const otherContent = otherItem.querySelector('.accordion-content');
          const otherIcon = otherItem.querySelector('.accordion-icon');
          otherContent?.classList.add('hidden');
          otherIcon?.classList.remove('rotate-180');
        });

        // Toggle current item
        if (!isOpen) {
          content?.classList.remove('hidden');
          icon?.classList.add('rotate-180');
        }
      });
    });
  });
</script>
