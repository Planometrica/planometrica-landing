---
import type { Pricing as SanityPricing } from '../lib/sanity'

interface LocalPricingTier {
  name: string
  badge?: string
  price: string
  priceNote?: string
  features: string[]
  ctaText: string
  ctaHref: string
  highlighted?: boolean
}

interface Props {
  tiers?: SanityPricing[] | LocalPricingTier[] | null
  badge?: string
  title?: string
}

const defaultTiers: LocalPricingTier[] = [
  {
    name: 'Старт',
    price: 'Бесплатно',
    features: [
      '1 проект',
      'AI-генерация планировок',
      'Экспорт в PDF',
      'Базовый CAD-редактор'
    ],
    ctaText: 'Начать бесплатно',
    ctaHref: 'https://studio.planometrica.pro/register'
  },
  {
    name: 'Профи',
    badge: 'Популярный',
    price: '2 990 ₽',
    priceNote: '/месяц',
    features: [
      'Безлимит проектов',
      'AI-рендер визуализации',
      'Экспорт DXF/DWG',
      '3D просмотр',
      'Приоритетная поддержка'
    ],
    ctaText: 'Выбрать Профи',
    ctaHref: 'https://studio.planometrica.pro/register',
    highlighted: true
  },
  {
    name: 'Команда',
    price: 'По запросу',
    features: [
      'Всё из Профи',
      'Командная работа',
      'API доступ',
      'Брендирование документов',
      'Персональный менеджер'
    ],
    ctaText: 'Связаться',
    ctaHref: 'mailto:hello@planometrica.pro'
  }
]

const {
  tiers: propsTiers,
  badge = 'Тарифы',
  title = 'Простые и понятные тарифы'
} = Astro.props

// Convert Sanity pricing to display format or use local format
const tiers = propsTiers?.map(t => {
  if ('ctaLink' in t) {
    // Sanity pricing
    return {
      name: t.name,
      badge: t.badge,
      price: t.price,
      priceNote: t.period === 'month' ? '/месяц' : t.period === 'year' ? '/год' : undefined,
      features: t.features || [],
      ctaText: t.ctaText || 'Выбрать',
      ctaHref: t.ctaLink || '#',
      highlighted: t.highlighted
    }
  }
  return t
}) || defaultTiers
---

<section class="py-20 lg:py-28 bg-white">
  <div class="container mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-16">
      <span class="inline-block px-4 py-2 bg-[#0A4C76]/10 text-[#0A4C76] font-medium rounded-full text-sm mb-4">
        {badge}
      </span>
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
        {title}
      </h2>
    </div>

    <!-- Pricing Cards -->
    <div class="max-w-5xl mx-auto">
      <div class="grid md:grid-cols-3 gap-6 lg:gap-8">
        {tiers.map((tier) => (
          <div class={`relative rounded-2xl p-6 lg:p-8 ${tier.highlighted
            ? 'bg-gradient-to-br from-[#0A4C76] to-[#1A7BB3] text-white shadow-2xl scale-105 border-0'
            : 'bg-white border-2 border-gray-100 hover:border-[#1A7BB3]/30'} transition-all duration-300`}
          >
            {/* Badge */}
            {tier.badge && (
              <span class={`absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1 text-xs font-semibold rounded-full ${
                tier.highlighted ? 'bg-[#92CF93] text-[#0A4C76]' : 'bg-[#0A4C76] text-white'
              }`}>
                {tier.badge}
              </span>
            )}

            {/* Name */}
            <h3 class={`text-xl font-bold mb-4 ${tier.highlighted ? 'text-white' : 'text-gray-900'}`}>
              {tier.name}
            </h3>

            {/* Price */}
            <div class="mb-6">
              <span class={`text-4xl lg:text-5xl font-bold ${tier.highlighted ? 'text-white' : 'text-[#0A4C76]'}`}>
                {tier.price}
              </span>
              {tier.priceNote && (
                <span class={`text-sm ml-2 ${tier.highlighted ? 'text-white/70' : 'text-gray-500'}`}>
                  {tier.priceNote}
                </span>
              )}
            </div>

            {/* Features */}
            <ul class="space-y-3 mb-8">
              {tier.features.map((feature) => (
                <li class={`flex items-start gap-2 text-sm ${tier.highlighted ? 'text-white/90' : 'text-gray-600'}`}>
                  <svg class={`w-5 h-5 flex-shrink-0 ${tier.highlighted ? 'text-[#92CF93]' : 'text-[#92CF93]'}`} fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                  </svg>
                  {feature}
                </li>
              ))}
            </ul>

            {/* CTA */}
            <a
              href={tier.ctaHref}
              class={`block w-full text-center py-3 px-6 rounded-xl font-semibold transition-all duration-200 ${
                tier.highlighted
                  ? 'bg-white text-[#0A4C76] hover:bg-gray-100'
                  : 'bg-[#0A4C76] text-white hover:bg-[#093d5f]'
              }`}
            >
              {tier.ctaText}
            </a>
          </div>
        ))}
      </div>

      {/* FAQ Link */}
      <div class="text-center mt-12">
        <p class="text-gray-600">
          Есть вопросы?{' '}
          <a href="/faq" class="text-[#1A7BB3] font-medium hover:underline">
            Посмотрите FAQ →
          </a>
        </p>
      </div>
    </div>
  </div>
</section>
