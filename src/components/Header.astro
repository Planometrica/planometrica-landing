---
// Header with navigation
interface Props {
  transparent?: boolean
}

const { transparent = false } = Astro.props
const currentPath = Astro.url.pathname

const navigation = {
  products: [
    { name: 'Студия', href: '/studio', description: 'Создайте проект своего дома' },
    { name: 'ПланоCAD', href: '/planocad', description: 'Профессиональное проектирование' },
    { name: 'НейроПлан', href: '/neuroplan', description: 'AI-ассистент проектирования' },
    { name: 'White-label', href: '/partners', description: 'Встройте в свою платформу' },
  ],
  capabilities: [
    { name: 'AI-Рендер', href: '/render', description: 'Фотореалистичная визуализация' },
    { name: 'Документы', href: '/docs', description: 'СПОЗУ, чертежи, пакеты' },
    { name: 'Ипотека', href: '/mortgage', description: 'Калькулятор и заявки' },
  ],
  solutions: [
    { name: 'Для частных заказчиков', href: '/studio', description: 'Создайте дом мечты сами' },
    { name: 'Для профессионалов', href: '/planocad', description: 'Ускорьте проектирование с AI' },
    { name: 'Для бизнеса', href: '/partners', description: 'White-label интеграция' },
  ],
  main: [
    { name: 'Тарифы', href: '/pricing' },
    { name: 'Блог', href: '/blog' },
    { name: 'FAQ', href: '/faq' },
  ]
}

const isActive = (href: string) => currentPath === href || currentPath.startsWith(href + '/')
---

<header
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
    transparent ? "bg-transparent" : "bg-white/95 backdrop-blur-md shadow-sm"
  ]}
  id="main-header"
>
  <nav class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <img
          src="/images/planometrica-logo-white.png"
          alt="Планометрика"
          class:list={[
            "h-8 w-auto",
            transparent ? "" : "brightness-0"
          ]}
        />
        <span
          class:list={[
            "text-xl font-semibold tracking-tight transition-colors font-logo",
            transparent ? "text-white" : "text-gray-900"
          ]}
        >
          Планометрика
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-1">
        <!-- Products Dropdown -->
        <div class="relative group">
          <button
            class:list={[
              "flex items-center gap-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              transparent
                ? "text-white/90 hover:text-white hover:bg-white/10"
                : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            Продукты
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Products Dropdown Menu -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-2 min-w-[300px]">
              {navigation.products.map((item) => (
                <a
                  href={item.href}
                  class:list={[
                    "flex flex-col px-4 py-3 rounded-xl transition-colors",
                    isActive(item.href)
                      ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                      : "hover:bg-gray-50 text-gray-900"
                  ]}
                >
                  <span class="font-medium">{item.name}</span>
                  <span class="text-sm text-gray-500">{item.description}</span>
                </a>
              ))}
            </div>
          </div>
        </div>

        <!-- Capabilities Dropdown -->
        <div class="relative group">
          <button
            class:list={[
              "flex items-center gap-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              transparent
                ? "text-white/90 hover:text-white hover:bg-white/10"
                : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            Возможности
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Capabilities Dropdown Menu -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-2 min-w-[300px]">
              {navigation.capabilities.map((item) => (
                <a
                  href={item.href}
                  class:list={[
                    "flex flex-col px-4 py-3 rounded-xl transition-colors",
                    isActive(item.href)
                      ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                      : "hover:bg-gray-50 text-gray-900"
                  ]}
                >
                  <span class="font-medium">{item.name}</span>
                  <span class="text-sm text-gray-500">{item.description}</span>
                </a>
              ))}
            </div>
          </div>
        </div>

        <!-- Solutions Dropdown -->
        <div class="relative group">
          <button
            class:list={[
              "flex items-center gap-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              transparent
                ? "text-white/90 hover:text-white hover:bg-white/10"
                : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            Решения
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Solutions Dropdown Menu -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-2 min-w-[300px]">
              {navigation.solutions.map((item) => (
                <a
                  href={item.href}
                  class:list={[
                    "flex flex-col px-4 py-3 rounded-xl transition-colors",
                    isActive(item.href)
                      ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                      : "hover:bg-gray-50 text-gray-900"
                  ]}
                >
                  <span class="font-medium">{item.name}</span>
                  <span class="text-sm text-gray-500">{item.description}</span>
                </a>
              ))}
            </div>
          </div>
        </div>

        <!-- Main Links -->
        {navigation.main.map((item) => (
          <a
            href={item.href}
            class:list={[
              "px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              isActive(item.href)
                ? transparent
                  ? "text-white bg-white/20"
                  : "text-[#0A4C76] bg-[#0A4C76]/10"
                : transparent
                  ? "text-white/90 hover:text-white hover:bg-white/10"
                  : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            {item.name}
          </a>
        ))}
      </div>

      <!-- CTA Button -->
      <div class="hidden lg:flex items-center">
        <a
          href="https://studio.planometrica.ru/register"
          class:list={[
            "px-5 py-2.5 text-sm font-semibold rounded-xl transition-all duration-200 inline-flex items-center gap-1",
            transparent
              ? "bg-white text-[#0A4C76] hover:bg-gray-100 shadow-lg"
              : "bg-[#0A4C76] text-white hover:bg-[#083d5f] shadow-md hover:shadow-lg"
          ]}
        >
          Начать
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        class="lg:hidden p-2 rounded-lg"
        id="mobile-menu-button"
        aria-label="Открыть меню"
      >
        <svg
          class:list={[
            "w-6 h-6",
            transparent ? "text-white" : "text-gray-900"
          ]}
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    class="lg:hidden fixed inset-0 bg-white z-50 transform translate-x-full transition-transform duration-300"
    id="mobile-menu"
  >
    <div class="flex flex-col h-full">
      <!-- Mobile Header -->
      <div class="flex items-center justify-between px-4 h-16 border-b">
        <a href="/" class="flex items-center gap-2">
          <img
            src="/images/planometrica-logo-white.png"
            alt="Планометрика"
            class="h-8 w-auto brightness-0"
          />
          <span class="text-xl font-semibold text-gray-900 font-logo">Планометрика</span>
        </a>
        <button
          class="p-2 rounded-lg hover:bg-gray-100"
          id="mobile-menu-close"
          aria-label="Закрыть меню"
        >
          <svg class="w-6 h-6 text-gray-900" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div class="flex-1 overflow-y-auto py-4 px-4">
        <!-- Products Section -->
        <div class="mb-6">
          <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 px-3">
            Продукты
          </div>
          {navigation.products.map((item) => (
            <a
              href={item.href}
              class:list={[
                "flex flex-col px-3 py-3 rounded-xl transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              <span class="font-medium">{item.name}</span>
              <span class="text-sm text-gray-500">{item.description}</span>
            </a>
          ))}
        </div>

        <!-- Capabilities Section -->
        <div class="mb-6 border-t pt-4">
          <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 px-3">
            Возможности
          </div>
          {navigation.capabilities.map((item) => (
            <a
              href={item.href}
              class:list={[
                "flex flex-col px-3 py-3 rounded-xl transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              <span class="font-medium">{item.name}</span>
              <span class="text-sm text-gray-500">{item.description}</span>
            </a>
          ))}
        </div>

        <!-- Solutions Section -->
        <div class="mb-6 border-t pt-4">
          <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 px-3">
            Решения
          </div>
          {navigation.solutions.map((item) => (
            <a
              href={item.href}
              class:list={[
                "flex flex-col px-3 py-3 rounded-xl transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              <span class="font-medium">{item.name}</span>
              <span class="text-sm text-gray-500">{item.description}</span>
            </a>
          ))}
        </div>

        <!-- Main Links -->
        <div class="border-t pt-4">
          {navigation.main.map((item) => (
            <a
              href={item.href}
              class:list={[
                "block px-3 py-3 rounded-xl font-medium transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              {item.name}
            </a>
          ))}
        </div>
      </div>

      <!-- Mobile CTA -->
      <div class="p-4 border-t">
        <a
          href="https://studio.planometrica.ru/register"
          class="flex items-center justify-center gap-2 w-full px-4 py-3 text-center font-semibold text-white bg-[#0A4C76] rounded-xl hover:bg-[#083d5f] transition-colors"
        >
          Начать
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('mobile-menu-button')
  const menuClose = document.getElementById('mobile-menu-close')
  const mobileMenu = document.getElementById('mobile-menu')

  menuButton?.addEventListener('click', () => {
    mobileMenu?.classList.remove('translate-x-full')
    document.body.style.overflow = 'hidden'
  })

  menuClose?.addEventListener('click', () => {
    mobileMenu?.classList.add('translate-x-full')
    document.body.style.overflow = ''
  })

  // Header scroll effect — при скролле фон как у hero (тёмно-синий)
  const header = document.getElementById('main-header')

  if (header?.classList.contains('bg-transparent')) {
    const updateHeader = () => {
      if (window.scrollY > 50) {
        header.classList.remove('bg-transparent')
        header.classList.add('bg-[#0A4C76]/95', 'backdrop-blur-md', 'shadow-sm')
      } else {
        header.classList.add('bg-transparent')
        header.classList.remove('bg-[#0A4C76]/95', 'backdrop-blur-md', 'shadow-sm')
      }
    }
    window.addEventListener('scroll', updateHeader, { passive: true })
    updateHeader()
  }
</script>
