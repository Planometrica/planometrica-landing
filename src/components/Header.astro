---
// Header with navigation
interface Props {
  transparent?: boolean
}

const { transparent = false } = Astro.props
const currentPath = Astro.url.pathname

const navigation = {
  products: [
    { name: 'Студия', href: '/studio', description: 'Полный цикл проектирования дома' },
    { name: 'ПланоCAD', href: '/planocad', description: 'Профессиональный CAD-редактор' },
    { name: 'НейроПлан', href: '/neuroplan', description: 'AI-генерация планировок' },
    { name: 'AI-Рендер', href: '/render', description: '3D визуализация за секунды' },
    { name: 'Ипотека', href: '/mortgage', description: 'Расчёт и подбор ипотеки' },
    { name: 'Документы', href: '/docs', description: 'СПОЗУ, проектный пакет' },
  ],
  main: [
    { name: 'Блог', href: '/blog' },
    { name: 'FAQ', href: '/faq' },
  ]
}

const isActive = (href: string) => currentPath === href || currentPath.startsWith(href + '/')
---

<header
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-300",
    transparent ? "bg-transparent" : "bg-white/95 backdrop-blur-md shadow-sm"
  ]}
  id="main-header"
>
  <nav class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16 lg:h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <svg
          class:list={[
            "w-8 h-8 transition-colors",
            transparent ? "text-white" : "text-[#0A4C76]"
          ]}
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
        </svg>
        <span
          class:list={[
            "text-xl font-semibold tracking-tight transition-colors",
            transparent ? "text-white" : "text-gray-900"
          ]}
        >
          Планометрика
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-1">
        <!-- Products Dropdown -->
        <div class="relative group">
          <button
            class:list={[
              "flex items-center gap-1 px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              transparent
                ? "text-white/90 hover:text-white hover:bg-white/10"
                : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            Продукты
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
            <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-2 min-w-[280px]">
              {navigation.products.map((item) => (
                <a
                  href={item.href}
                  class:list={[
                    "flex flex-col px-4 py-3 rounded-xl transition-colors",
                    isActive(item.href)
                      ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                      : "hover:bg-gray-50 text-gray-900"
                  ]}
                >
                  <span class="font-medium">{item.name}</span>
                  <span class="text-sm text-gray-500">{item.description}</span>
                </a>
              ))}
            </div>
          </div>
        </div>

        <!-- Main Links -->
        {navigation.main.map((item) => (
          <a
            href={item.href}
            class:list={[
              "px-4 py-2 text-sm font-medium rounded-lg transition-colors",
              isActive(item.href)
                ? transparent
                  ? "text-white bg-white/20"
                  : "text-[#0A4C76] bg-[#0A4C76]/10"
                : transparent
                  ? "text-white/90 hover:text-white hover:bg-white/10"
                  : "text-gray-700 hover:text-gray-900 hover:bg-gray-100"
            ]}
          >
            {item.name}
          </a>
        ))}
      </div>

      <!-- CTA Buttons -->
      <div class="hidden lg:flex items-center gap-3">
        <a
          href="https://studio.planometrica.pro/login"
          class:list={[
            "px-4 py-2 text-sm font-medium rounded-lg transition-colors",
            transparent
              ? "text-white hover:bg-white/10"
              : "text-gray-700 hover:bg-gray-100"
          ]}
        >
          Войти
        </a>
        <a
          href="https://studio.planometrica.pro/register"
          class:list={[
            "px-5 py-2.5 text-sm font-semibold rounded-xl transition-all duration-200",
            transparent
              ? "bg-white text-[#0A4C76] hover:bg-gray-100 shadow-lg"
              : "bg-[#0A4C76] text-white hover:bg-[#083d5f] shadow-md hover:shadow-lg"
          ]}
        >
          Начать бесплатно
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        class="lg:hidden p-2 rounded-lg"
        id="mobile-menu-button"
        aria-label="Открыть меню"
      >
        <svg
          class:list={[
            "w-6 h-6",
            transparent ? "text-white" : "text-gray-900"
          ]}
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    class="lg:hidden fixed inset-0 bg-white z-50 transform translate-x-full transition-transform duration-300"
    id="mobile-menu"
  >
    <div class="flex flex-col h-full">
      <!-- Mobile Header -->
      <div class="flex items-center justify-between px-4 h-16 border-b">
        <a href="/" class="flex items-center gap-2">
          <svg class="w-8 h-8 text-[#0A4C76]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <span class="text-xl font-semibold text-gray-900">Планометрика</span>
        </a>
        <button
          class="p-2 rounded-lg hover:bg-gray-100"
          id="mobile-menu-close"
          aria-label="Закрыть меню"
        >
          <svg class="w-6 h-6 text-gray-900" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Mobile Navigation -->
      <div class="flex-1 overflow-y-auto py-4 px-4">
        <div class="mb-6">
          <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 px-3">
            Продукты
          </div>
          {navigation.products.map((item) => (
            <a
              href={item.href}
              class:list={[
                "flex flex-col px-3 py-3 rounded-xl transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              <span class="font-medium">{item.name}</span>
              <span class="text-sm text-gray-500">{item.description}</span>
            </a>
          ))}
        </div>

        <div class="border-t pt-4">
          {navigation.main.map((item) => (
            <a
              href={item.href}
              class:list={[
                "block px-3 py-3 rounded-xl font-medium transition-colors",
                isActive(item.href)
                  ? "bg-[#0A4C76]/10 text-[#0A4C76]"
                  : "text-gray-900 hover:bg-gray-50"
              ]}
            >
              {item.name}
            </a>
          ))}
        </div>
      </div>

      <!-- Mobile CTA -->
      <div class="p-4 border-t space-y-3">
        <a
          href="https://studio.planometrica.pro/login"
          class="block w-full px-4 py-3 text-center font-medium text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors"
        >
          Войти
        </a>
        <a
          href="https://studio.planometrica.pro/register"
          class="block w-full px-4 py-3 text-center font-semibold text-white bg-[#0A4C76] rounded-xl hover:bg-[#083d5f] transition-colors"
        >
          Начать бесплатно
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('mobile-menu-button')
  const menuClose = document.getElementById('mobile-menu-close')
  const mobileMenu = document.getElementById('mobile-menu')

  menuButton?.addEventListener('click', () => {
    mobileMenu?.classList.remove('translate-x-full')
    document.body.style.overflow = 'hidden'
  })

  menuClose?.addEventListener('click', () => {
    mobileMenu?.classList.add('translate-x-full')
    document.body.style.overflow = ''
  })

  // Header scroll effect (for transparent headers)
  const header = document.getElementById('main-header')

  if (header?.dataset.transparent === 'true') {
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        header.classList.remove('bg-transparent')
        header.classList.add('bg-white/95', 'backdrop-blur-md', 'shadow-sm')
      } else {
        header.classList.add('bg-transparent')
        header.classList.remove('bg-white/95', 'backdrop-blur-md', 'shadow-sm')
      }
    })
  }
</script>
